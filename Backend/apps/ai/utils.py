import numpy as np
import joblib


def get_loaded_model(pkl_file: str):
    loaded_model = joblib.load(pkl_file)
    return loaded_model


def preprocess_input(input_params):
    input_params = np.array(input_params).reshape(1, -1)
    if input_params.shape[1] != 297:
        raise ValueError(
            f"Input data must have 297 features, but has {input_params.shape[1]} features"
        )

    return input_params

def predict_device_category(input_params):
    loaded_model = get_loaded_model(pkl_file="apps/ai/fixture/RandomForest_model.pkl")
    input_params = preprocess_input(input_params)
    prediction = loaded_model.predict(input_params).tolist()
    return prediction
    

def get_sample_inputs() -> dict:
    sample_inputs = {}
    sample_inputs["security_camera"] = [9, 5, 5, 1213, 743, 1.806873527, 668, 0, 0, 0.689, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2147483647, 0, 0, 0, 0, 0, 0, 648.797378, 0, 366.0955909, 1547.304718, 490.697626, 218.6343271, 0, 2840.981562, 694.86998, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.043064058, 3.5, 9.54E-07, 0.195948839, 0.011465549, 0, 0.057043676, 0.689024925, 0.085982859, 0.003253981, 0.046643294, 2, 0, 0.286142826, 9.54E-07, 0, 0.085642365, 0.551958263, 0.088184834, 0.007334615, 0.022967498, 3.864853098, 9.54E-07, 0.195948839, 0.001270652, 0, 0.045001936, 0.689024925, 0.017653823, 0.002025174, 41.14893617, 0.850178203, 0, 195, 0, 0, 65, 316, 0, 4225, 159, 0.918295834, 0, 477, 0, 0, 275.3960784, 477, 238.5, 75843, 64.625, 1.061278124, 0, 477, 0, 0, 167.211532, 679, 60.5, 27959.69643, 10, 5, 0.823480972, 5, 3, 1, 1, 2, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 139, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 64, 0, 64, 64, 64, 64, 0, 1088, 64, 0, 129.8, 0.371232327, 107, 235, 108, 42, 51.58141969, 512, 229, 2660.642857, 135, 1.160887129, 64, 235, 64, 42, 79.31015067, 4185, 235, 6290.1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0
]
    sample_inputs['TV'] = [9, 5, 5, 1213, 743, 1.806873527, 668, 0, 0, 1.5756, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2147483647, 0, 0, 0, 0, 0, 0, 648.797378, 0, 366.0955909, 1547.304718, 490.697626, 218.6343271, 0, 2840.981562, 694.86998, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.004308835, 4.754887502, 1.60E-05, 0.430767059, 0.000591993, 0, 0.021882096, 1.882961035, 0.003140926, 0.000478826, 0.00128031, 2, 0.000120163, 0.342990351, 0.000121117, 9.54E-07, 0.013426324, 0.551958263, 0.000941455, 0.000180266, 0.001005855, 4.889680181, 0.000119925, 0.413473129, 0.000121832, 0, 0.009999577, 1.882961035, 0.000748456, 1.00E-04, 2.025114155, 0.111977352, 0, 195, 0, 0, 25.40935897, 316, 0, 645.6355234, 159, 0.475650299, 0, 477, 0, 0, 181.8175747, 477, 238.5, 33057.63048, 64.625, 1.061278124, 0, 477, 0, 0, 167.211532, 679, 60.5, 27959.69643, 10, 5, 0.83328704, 5, 3, 1, 1, 2, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1321, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 0, 64, 0, 64, 64, 64, 64, 0, 7140, 64, 0, 54.99651568, 0.033467197, 55, 55, 55, 54, 0.05894575, 512, 55, 0.003474601, 57.10197544, 0.810302531, 55, 64, 55, 54, 3.812339578, 7140, 55, 14.53393306, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0]
    sample_inputs['watch']= [23, 13, 10, 7119, 5164, 2.641430874, 1955, 0, 0, 10.7697, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2147483647, 0, 0, 0, 0, 0, 0, 648.797378, 0, 366.0955909, 1547.304718, 490.697626, 218.6343271, 0, 2840.981562, 694.86998, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.82843654, 3.700439718, 0.002070189, 9.511498928, 0.146999121, 0, 2.611284627, 10.76967502, 0.176754951, 6.818807401, 1.182123343, 3.169925001, 0.001219988, 9.828384876, 0.046416044, 4.10E-05, 3.24489739, 10.63911009, 0.256114006, 10.52935907, 0.46824674, 4.523561956, 0.001325607, 9.511498928, 0.037510157, 0, 1.972639279, 10.76967502, 0.091286421, 3.891305723, 73.07142857, 1.43454914, 0, 703, 0, 0, 189.3208365, 1023, 17.25, 35842.37912, 449.6, 2.321928095, 0, 1388, 213, 0, 567.6325494, 4496, 748.5, 322206.7111, 229.9583333, 2.28067213, 0, 1388, 0, 0, 426.96222, 5519, 230, 182296.7373, 24, 10, 0.714234698, 14, 8, 4, 4, 0, 0, 0, 3, 5, 20, 1, 1, 4, 3, 1, 1, 1, 1, 1, 1, 52392, 1779, 771, 0.444638014, 0, 0.444638014, 0.444638014, 0.444638014, 0.444638014, 0, 0.444638014, 0.444638014, 0, 0, 1, 698, 0, 698, 698, 698, 698, 0, 698, 698, 0, 408.5, 1, 393.25, 439, 408.5, 378, 43.13351365, 817, 423.75, 1860.5, 0, 0, 0, 0, 0, 0, 64, 0, 64, 64, 64, 64, 0, 896, 64, 0, 52.5, 1, 52, 53, 52.5, 52, 0.527046277, 525, 53, 0.277777778, 59.20833333, 1.396535423, 53, 64, 64, 52, 5.800893235, 1421, 64, 33.65036232, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0]
    return sample_inputs